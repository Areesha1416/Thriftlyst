<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ThriftOps Directory - National Thrift Store Directory</title>
    <link rel="stylesheet" type="text/css" href="./css/common.css" />
    <link rel="stylesheet" type="text/css" href="./css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="./css/header.css" />
    <link rel="stylesheet" type="text/css" href="./css/footer.css" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- Font Awesome CDN -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
     <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap JS Bundle (for collapse, modal, dropdown, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
      body {
        background-color: #f1f3f8;
        font-family: 'poppins', sans-serif;
      }
      .main-container {
        display: flex;
        gap: 20px;
        max-width: 90%;
        margin: 0px auto;
        margin-top: 50px;
        padding-left:5% ;
        padding-right:5% ;
      }
      .left-container,
      .right-container {
        padding: 20px;
        border-radius: 8px;
      }
      .left-container {
        flex: 2;
      }
      .right-container {
        flex: 1;
        
      }
      .header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }
      .header img {
        height: 70px;
        width: 70px;
        object-fit: contain;
      }
      .header h4 {
        font-size: 28px;
        font-weight: 500;
        
        line-height: 33px;
        word-wrap: break-word;
      }
      .rating-box {
        display: flex;
        justify-content: right;
        align-items: center;
        gap: 20px;
        margin-bottom: 10px;
      }
      .rating {
        background: #28a745;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: 700;
        font-size: 20px;
      }
      .reviews-count {
        color: #797979;
        font-size: 13px;
      }

      .address {
        color: #797979;
        margin-bottom: 15px;
      }

      .reviews-section {
        margin-top: 20px;
      }
      .summary,
      .reviews-section h5 {
        font-size: 18px;
      }
      .review-card {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }
      .review-left {
        flex: 1;
        text-align: center;
        padding: 15px 0px;
      }
      .review-left img {
        height: 60px;
        width: 60px;
        object-fit: contain;
        border-radius: 50%;
        margin-bottom: 5px;
      }
      .review-right {
        flex: 4;

        padding: 10px;
        border-radius: 8px;
        position: relative;
      }
      .review-right .header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-weight: 600;
      }
      .review-right .stars i {
        color: #f5c518;
      }
      .review-right hr {
        margin: 10px 0;
        border: none;
        border-top: 1px solid #ccc;
      }
      .review-text {
        text-align: justify;
      }
      .right-container-top {
        display: flex;
        background-color: #fff;
        flex-direction: column;
        justify-content: center;
        border: 1px solid grey;
        border-bottom: 0px;
        padding: 10px;
      }
      .today-status {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        margin-bottom: 10px;
      }
      .timing-list {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        margin-bottom: 10px;
      }
      .timing-list ul {
        padding-left: 20px;
        margin: 0;
      }
      .contact-form h5 {
        margin-bottom: 15px;
      }
      .contact-form .form-group {
        position: relative;
        margin-bottom: 15px;
      }
      .contact-form .form-group input,
      .contact-form .form-group textarea {
        width: 100%;
        padding-right: 35px;
      }
      .contact-form .form-group i {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
      }
      .sendbtn {
        background: red;
        color: #fff;
        height:70px;
        border: none;
        border-radius: 0px;
        padding: 0px;
      }

      hr {
        border: none;
        border-top: 1px solid #3b3838;
        margin: 15px 0; /* spacing upar neeche */
      }
      /* ===== Responsive Media Queries ===== */
/* Prevent horizontal scroll on small screens */
body, html {
  overflow-x: hidden;
}

/* Force containers to fit in screen */
.main-container,
.left-container,
.right-container {
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
}

/* Make images shrink on small screens */
img {
  max-width: 100%;
  height: auto;
}

/* Mobile-specific fixes */
@media (max-width: 768px) {
  .main-container {
    flex-direction: column;
    gap: 15px;
  }
  .review-card {
    flex-direction: column;
    align-items: flex-start;
  }
  .review-left, .review-right {
    width: 100%;
  }
}

    </style>
  </head>
  <body>
    
    <div id="header"></div>
    <script src="load-header.js"></script>

    <div class="main-container">
      <!-- Left Container -->
      <div class="left-container" id="leftContainer">
        <!-- Dynamic content goes here -->
      </div>

      <!-- Right Container -->
      <!-- Right Container -->
<div class="right-container">
  <div class="right-container-top">
    <!-- Today Status + Toggle -->
  <div class="today-status d-flex justify-content-between align-items-center" id="toggleTiming">
    <span id="todayStatus">Today: Open</span>
    <button class="btn btn-sm btn-outline-secondary" id="toggleBtn">
      <i class="fa fa-plus"></i>
    </button>
  </div>

  <!-- Timing List -->
  <div class="timing-list" id="timingList">
    <ul id="timingUl" class="list-unstyled ps-3"></ul>
  </div>

  <!-- Contact Form -->

  <div class="contact-form mt-4 text-center">
    <h5 class="mb-3">Claim Your Store</h5>
    <p class="small text-muted">
      Schedule a call with us to claim your store and learn more about ThriftOps.
    </p>
  </div>

  
  </div>
  <a 
      href="https://calendly.com/mateenansari/thriftops-demo-call"
      target="_blank"
      class="sendbtn btn btn-danger w-100"
      style="border: none;"
    ><button class="sendbtn btn btn-danger w-100">
      <i class="fa fa-paper-plane"></i> Book on Calendly
  </button>
      
    </a>
  

  
</div>


    <script>
  const API_BASE_URL = "https://swag.thriftops.com/Directory";

  // Toggle timing collapse
  const toggleTiming = document.getElementById("toggleTiming");
  const timingList = document.getElementById("timingList");
  const toggleIcon = document.getElementById("toggleIcon");

  toggleTiming.addEventListener("click", () => {
    if (timingList.style.maxHeight) {
      timingList.style.maxHeight = null;
      toggleIcon.textContent = "+";
    } else {
      timingList.style.maxHeight = timingList.scrollHeight + "px";
      toggleIcon.textContent = "-";
    }
  });

  // ðŸ”¹ Parse the store slug from the URL (e.g. /store/thrift-hub)
  const pathParts = window.location.pathname.split("/").filter(Boolean);
  const storeSlug = pathParts[1]; // e.g. "thrift-hub"

  const leftContainer = document.getElementById("leftContainer");
  let storeData = JSON.parse(localStorage.getItem("selectedStore") || "null");

  // âœ… Check if the local store matches the current slug
  if (
    storeData &&
    storeData.name.trim().toLowerCase().replace(/\s+/g, "-") !== storeSlug
  ) {
    storeData = null;
  }

  // âœ… If no matching store in localStorage, fetch it
  if (!storeData && storeSlug) {
    fetch(`${API_BASE_URL}/getAllStores.php`) // Adjust endpoint if different
      .then((res) => res.json())
      .then((stores) => {
        const match = stores.find(
          (s) =>
            s.name &&
            s.name.trim().toLowerCase().replace(/\s+/g, "-") === storeSlug
        );
        if (match) {
          localStorage.setItem("selectedStore", JSON.stringify(match));
          renderStore(match);
        } else {
          leftContainer.innerHTML = "<p>No matching store found.</p>";
        }
      })
      .catch((err) => {
        console.error("Error fetching store:", err);
        leftContainer.innerHTML =
          "<p>Failed to load store data. Please try again later.</p>";
      });
  } else if (storeData) {
    renderStore(storeData);
  } else {
    leftContainer.innerHTML = "<p>No data found. Go back to listings.</p>";
  }

  // ðŸ”¹ Render the store info dynamically
  function renderStore(storeData) {
    leftContainer.innerHTML = `
      <div class="header d-flex align-items-center">
        <div class="me-3">
          <img src="${
            storeData.photos && storeData.photos.length > 0
              ? storeData.photos[0]
              : "./assets/e474a0171b0e6a9a49ee107efb844fb3.svg"
          }" 
          alt="${storeData.name}" 
          style="border-radius: 50%; object-fit: cover; width:80px; height:80px;">
        </div>

        <div>
          <h4 class="mb-1">${storeData.name}</h4>
          <div class="social-links">
            <a href="${storeData.facebook || "#"}" target="_blank" class="me-3">
              <i class="fab fa-facebook fa-lg"></i>
            </a>
            <a href="${storeData.instagram || "#"}" target="_blank">
              <i class="fab fa-instagram fa-lg"></i>
            </a>
          </div>
        </div>
      </div>

      <div class="rating-box">
        <div class="rating">${storeData.rating || 0}/5</div>
        <div class="reviews-count">${storeData.totalRatings || 0} Reviews</div>
      </div>

      <div class="address">
        <a 
          href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
            storeData.address
          )}" 
          target="_blank">
          ${storeData.address || "Address not available"}
        </a>
      </div>

      <hr>
      <div class="summary-section"><p>Loading summary...</p></div>
      <hr>

      <div class="reviews-section">
        <h5>${storeData.totalRatings || 0} Reviews for ${storeData.name}</h5>
        <hr>
        ${
          storeData.reviews && storeData.reviews.length > 0
            ? storeData.reviews
                .map((review) => {
                  const reviewerName =
                    review.name && review.name.trim() !== ""
                      ? review.name
                      : "Anonymous";
                  return `
                    <div class="review-card">
                      <div class="review-left">
                        <i class="fa fa-user-circle fa-2x" style="color:#999;"></i>
                        <div>${reviewerName}</div>
                      </div>
                      <div class="review-right">
                        <div class="header">
                          <span>${reviewerName}${
                    review.date ? `, ${review.date}` : ""
                  }</span>
                        </div>
                        <div class="review-text">${
                          review.text || "No review provided"
                        }</div>
                      </div>
                    </div>
                  `;
                })
                .join("")
            : "<p>No reviews yet.</p>"
        }
      </div>
    `;

    // Right container: timing
    const timingUl = document.getElementById("timingUl");
    if (storeData.timings && storeData.timings.length > 0) {
      timingUl.innerHTML = storeData.timings
        .map((t) => `<li>${t.day}: ${t.hours}</li>`)
        .join("");
    } else {
      timingUl.innerHTML = "<li>Timing not available</li>";
    }

    // Todayâ€™s status
    const todayStatus = document.getElementById("todayStatus");
    todayStatus.textContent = `Today: ${storeData.todayStatus || "Open"}`;

    // Load AI summary
    loadSummary(storeData);
  }

  // ðŸ”¹ Fetch AI-generated summary
  async function loadSummary(store) {
    const summarySection = document.querySelector(".summary-section");

    try {
      const summaryRes = await fetch(`${API_BASE_URL}/summarize-reviews.php`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: store.id,
          reviews: store.reviews || [],
          city: store.city || "Unknown",
          storetype: store.storeType || "General",
        }),
      });

      const data = await summaryRes.json();

      if (data && data.summary && data.summary.trim() !== "") {
        summarySection.innerHTML = `<p>${data.summary}</p>`;
      } else {
        summarySection.innerHTML = `<p>No content available.</p>`;
      }
    } catch (err) {
      console.error("Error fetching summary:", err);
      summarySection.innerHTML = `
        <h5>Summary</h5>
        <p>Summary not available at the moment.</p>
      `;
    }
  }
</script>


  </body>
</html>
